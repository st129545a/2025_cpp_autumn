name: Compile All C++ Files

on:
  push:
    branches: [main, master]
  workflow_dispatch:

jobs:
  compile:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Find and compile all .cpp files
      run: |
        echo "=== Searching for all .cpp files ==="
        find . -name "*.cpp" | while read cpp_file; do
          echo ""
          echo "=== Compiling: $cpp_file ==="
          dir_name=$(dirname "$cpp_file")
          base_name=$(basename "$cpp_file" .cpp)
          
          cd "$dir_name"
          if g++ -std=c++17 -o "${base_name}_program" "$cpp_file" 2>&1; then
            echo "✓ Compilation successful"
            if [ -f "${base_name}_program" ]; then
              echo "Running program..."
              timeout 5s ./"${base_name}_program" && echo "✓ Execution successful" || echo "✗ Execution failed or timed out"
            fi
          else
            echo "✗ Compilation failed"
          fi
          cd - > /dev/null
        done
